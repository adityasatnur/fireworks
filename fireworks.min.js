!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define("Fireworks",i):t.Fireworks=i()}(this,function(){"use strict";var t=function(i,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])})(i,s)};function i(t,i){return Math.random()*(i-t)+t}var s=2*Math.PI,o=function(){function t(t){var o=t.isRocket,n=void 0!==o&&o,e=t.hue,h=void 0===e?i(1,360):e,r=t.brightness,a=void 0===r?i(50,60):r,c=t.position;if(this.isRocket=n,this.position=c,this.positions=[this.position,this.position,this.position],this.isRocket)this.velocity={x:i(-3,3),y:i(-7,-3)},this.shrink=.999,this.resistance=1;else{var p=i(0,s),l=15*Math.cos(i(0,s));this.velocity={x:Math.cos(p)*l,y:Math.sin(p)*l},this.shrink=i(0,.05)+.93,this.resistance=.92}this.gravity=.01,this.size=3,this.alpha=1,this.fade=0,this.hue=h,this.brightness=a}return t.prototype.clone=function(){return new t({position:{x:this.position.x,y:this.position.y},hue:this.hue,brightness:this.brightness})},t.prototype.shouldRemove=function(t,i){return this.alpha<=.1||this.size<=1||(this.position.x>t||this.position.x<0||(this.position.y>i||this.position.y<0))},t.prototype.shouldExplode=function(t,s,o){return!!this.isRocket&&(this.position.y<=t||!(this.position.y>=s)&&i(0,1)<=o)},t.prototype.update=function(){this.positions.pop(),this.positions.unshift({x:this.position.x,y:this.position.y}),this.velocity.x*=this.resistance,this.velocity.y*=this.resistance,this.velocity.y+=this.gravity,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.size*=this.shrink,this.alpha-=this.fade},t.prototype.draw=function(t){var i=this.positions[this.positions.length-1];t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(this.position.x,this.position.y),t.lineWidth=this.size,t.strokeStyle="hsla("+this.hue+", 100%, "+this.brightness+"%, "+this.alpha+")",t.stroke()},t}(),n=function(s){function n(t){var i=t.maxRockets,o=t.numParticles,n=t.cw,e=t.ch,h=s.call(this)||this;return h.rockets=0,h.maxRockets=i,h.numParticles=o,h.cw=n,h.ch=e,h}return function(i,s){function o(){this.constructor=i}t(i,s),i.prototype=null===s?Object.create(s):(o.prototype=s.prototype,new o)}(n,s),n.prototype.explode=function(t){this.rockets--;for(var i=0;i<this.numParticles;i+=1)this.add(t.clone());this.delete(t)},n.prototype.spawnRocket=function(){this.rockets++,this.add(new o({isRocket:!0,position:{x:i(0,this.cw),y:this.ch}}))},n.prototype.spawnRockets=function(){this.rockets<this.maxRockets&&this.spawnRocket()},n}(Set);return function(){function t(t,i){var s=void 0===i?{}:i,o=s.rocketSpawnInterval,e=void 0===o?150:o,h=s.maxRockets,r=void 0===h?3:h,a=s.numParticles,c=void 0===a?100:a,p=s.explosionMinHeight,l=void 0===p?.2:p,u=s.explosionMaxHeight,f=void 0===u?.9:u,v=s.explosionChance,d=void 0===v?.08:v;this.rocketSpawnInterval=e,this.maxRockets=r,this.cw=t.clientWidth,this.ch=t.clientHeight,this.max_h=this.ch*(1-f),this.min_h=this.ch*(1-l),this.chance=d,this.canvas=document.createElement("canvas"),this.canvas.width=this.cw,this.canvas.height=this.ch,this.ctx=this.canvas.getContext("2d"),t.appendChild(this.canvas),this.things=new n({maxRockets:this.maxRockets,numParticles:c,cw:this.cw,ch:this.ch})}return t.prototype.destroy=function(){this.canvas.parentElement.removeChild(this.canvas),window.clearInterval(this.interval),window.cancelAnimationFrame(this.rafInterval)},t.prototype.start=function(){var t=this;return this.maxRockets>0&&(this.interval=setInterval(function(){return t.things.spawnRockets()},this.rocketSpawnInterval),this.rafInterval=window.requestAnimationFrame(function(){return t.update()})),function(){return t.stop()}},t.prototype.stop=function(){window.clearInterval(this.interval),this.interval=null},t.prototype.kill=function(){this.things.clear(),this.stop(),window.cancelAnimationFrame(this.rafInterval),this.rafInterval=null,this._clear(!0)},t.prototype.fire=function(){var t=this;this.things.spawnRocket(),this.rafInterval||(this.rafInterval=window.requestAnimationFrame(function(){return t.update()}))},t.prototype._clear=function(t){void 0===t&&(t=!1),this.ctx.globalCompositeOperation="destination-out",this.ctx.fillStyle="rgba(0, 0, 0 "+(t?"":", 0.5")+")",this.ctx.fillRect(0,0,this.cw,this.ch),this.ctx.globalCompositeOperation="lighter"},t.prototype.update=function(){var t,i,s=this;this._clear();try{for(var o=function(t){var i="function"==typeof Symbol&&t[Symbol.iterator],s=0;return i?i.call(t):{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}}}(this.things),n=o.next();!n.done;n=o.next()){var e=n.value;e.draw(this.ctx),e.update(),e.shouldRemove(this.cw,this.ch)?this.things.delete(e):e.shouldExplode(this.max_h,this.min_h,this.chance)&&this.things.explode(e)}}catch(i){t={error:i}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}this.interval||this.things.size>0?this.rafInterval=window.requestAnimationFrame(function(){return s.update()}):(this._clear(!0),this.rafInterval=null)},t}()});
